<style>* { margin: 0; padding: 0; } body { zoom: 200%;} canvas { transform: scale(1, -1); }</style>
<body></body>
<script src="babylon.2.3.js"></script>
<script src="jquery.js"></script>
<script>

// src
var onMapload = function (img) {
	// create canvas
	var canvas = document.createElement("canvas");
	canvas.id='test';
	context = canvas.getContext("2d");
	canvas.width = 512;
	canvas.height = 512;
	context.drawImage(img,
		0,0,512,512,
		0,0,512,512
	);

	var canvas2 = document.createElement("canvas");
	$('body').append($(canvas2).css({width: '512px', height: '512px', display: 'block'}));
	context2 = canvas2.getContext("2d");
	canvas2.width = 512;
	canvas2.height = 512;
	var imgData = context.getImageData(0, 0, 512, 512);
	buffer = imgData.data;
	context2.fillStyle = '#000';
	context2.fillRect(0,0,512,512);

	for (var i = 0; i < 512 * 512 * 4; i += 4) {
		var r = buffer[i + 0];
		var g = buffer[i + 1];
		var b = buffer[i + 2];
		if (r == 0 && g == 0 && b == 0) { // sea
			buffer[i + 0] = 64;
			buffer[i + 1] = 128;
			buffer[i + 2] = 192;
		} else if (g > 192) { // desert
			buffer[i + 0] = 220;
			buffer[i + 1] = 210;
			buffer[i + 2] = 100;
		} else if (b > 128) { // rock
			buffer[i + 0] = 192;
			buffer[i + 1] = 192;
			buffer[i + 2] = 192;
		} else if (r > 192) { // tree
			buffer[i + 0] = 0;
			buffer[i + 1] = 128;
			buffer[i + 2] = 0;
		} else { // soil
			buffer[i + 0] = 128;
			buffer[i + 1] = 255;
			buffer[i + 2] = 128;
		}
	}
//	console.log(buffer);
	context2.putImageData(imgData, 0,0);
	return;

	for (var x = 800; x < 1200; x++) {
		for (var y = 800; y < 1300; y++) {
			var offset = x * 4 + y * 512 * 4;
			var height = buffer[offset + 0];
			var foliage = buffer[offset + 1];
			var road = buffer[offset + 2];
			var isTree = false;
			context2.filter = 'none';
			context2.shadowBlur = 0;
			context2.shadowColor = '#000';
			if (height < 80) continue;
			context2.fillStyle = '#e2be85'; // soil
			if (foliage > 10 && height > 120) {
				context2.fillStyle = '#95e256'; // foliage
			}
			if (foliage > 50 && height > 120) {
				var isTree = true;
				context2.fillStyle = '#448822'; // trees
			}
			if (height >= 80 && height < 122) {
				context2.fillStyle = 'rgba(98,222,218,' + ((height - 80) / 255 * 4) + ')'; // shallows
			}
			if (height >= 118 && height < 122) {
				context2.shadowBlur = 1;
				context2.shadowColor = '#ded462';
				context2.fillStyle = '#ded462'; // beach
				context2.fillRect(x,y - 00,1,1);
			}
			if (road > 128) {
				context2.fillStyle = '#8e653d'; // road
			}
			if (isTree) {
//				context2.filter = 'blur(1px)';
				context2.shadowBlur = 1;
				context2.shadowColor = '#448822';
				context2.fillRect(x -1,y - 00,3,1);
				context2.fillRect(x,y - 00 - 1,1,3);
			} else {
				context2.fillRect(x,y - 00,1,1);
			}

		}
	}
				//context2.filter = 'blur(1px)';
};
BABYLON.Tools.LoadImage('textures/map2.png', onMapload);


// map

</script>